

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: core.src.js | Source: core.src.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Source: core.src.js</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Accessibility.html">Accessibility</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Accessibility_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Accessibility.html#._cache">_cache</a></li><li><a href="Accessibility.html#.cache">cache</a></li><li><a href="Accessibility.html#.cache">cache</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Accessibility.html#.mathMLToAccessible">mathMLToAccessible</a></li></ul></div></li><li><a href="Configuration.html">Configuration</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Configuration_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Configuration.html#._properties">_properties</a></li><li><a href="Configuration.html#.properties">properties</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Configuration.html#.addConfiguration">addConfiguration</a></li><li><a href="Configuration.html#.get">get</a></li><li><a href="Configuration.html#.set">set</a></li><li><a href="Configuration.html#.update">update</a></li></ul></div></li><li><a href="Constants.html">Constants</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Constants_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Constants.html#.safeBadBlackboardCharacters">safeBadBlackboardCharacters</a></li><li><a href="Constants.html#.safeGoodBlackboardCharacters">safeGoodBlackboardCharacters</a></li><li><a href="Constants.html#.safeXmlCharacters">safeXmlCharacters</a></li><li><a href="Constants.html#.safeXmlCharactersEntities">safeXmlCharactersEntities</a></li><li><a href="Constants.html#.xmlCharacters">xmlCharacters</a></li></ul></div></li><li><a href="ContentManager.html">ContentManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentManager_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ContentManager.html#customEditors">customEditors</a></li><li><a href="ContentManager.html#deviceProperties">deviceProperties</a></li><li><a href="ContentManager.html#editor">editor</a></li><li><a href="ContentManager.html#editorAttributes">editorAttributes</a></li><li><a href="ContentManager.html#editorListener">editorListener</a></li><li><a href="ContentManager.html#environment">environment</a></li><li><a href="ContentManager.html#integrationModel">integrationModel</a></li><li><a href="ContentManager.html#isNewElement">isNewElement</a></li><li><a href="ContentManager.html#language">language</a></li><li><a href="ContentManager.html#listeners">listeners</a></li><li><a href="ContentManager.html#mathML">mathML</a></li><li><a href="ContentManager.html#modalDialogInstance">modalDialogInstance</a></li><li><a href="ContentManager.html#toolbar">toolbar</a></li><li><a href="ContentManager.html#ua">ua</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ContentManager.html#.getURLFromAnchorElement">getURLFromAnchorElement</a></li><li><a href="ContentManager.html#.isEditorLoaded">isEditorLoaded</a></li><li><a href="ContentManager.html#.setHrefToAnchorElement">setHrefToAnchorElement</a></li><li><a href="ContentManager.html#.setProtocolToAnchorElement">setProtocolToAnchorElement</a></li><li><a href="ContentManager.html#addEditorAsExternalDependency">addEditorAsExternalDependency</a></li><li><a href="ContentManager.html#addListener">addListener</a></li><li><a href="ContentManager.html#getToolbar">getToolbar</a></li><li><a href="ContentManager.html#hasChanges">hasChanges</a></li><li><a href="ContentManager.html#init">init</a></li><li><a href="ContentManager.html#insert">insert</a></li><li><a href="ContentManager.html#insertEditor">insertEditor</a></li><li><a href="ContentManager.html#onFocus">onFocus</a></li><li><a href="ContentManager.html#onKeyDown">onKeyDown</a></li><li><a href="ContentManager.html#onOpen">onOpen</a></li><li><a href="ContentManager.html#setEmptyMathML">setEmptyMathML</a></li><li><a href="ContentManager.html#setInitialContent">setInitialContent</a></li><li><a href="ContentManager.html#setIntegrationModel">setIntegrationModel</a></li><li><a href="ContentManager.html#setMathML">setMathML</a></li><li><a href="ContentManager.html#setModalDialogInstance">setModalDialogInstance</a></li><li><a href="ContentManager.html#setToolbar">setToolbar</a></li><li><a href="ContentManager.html#submitAction">submitAction</a></li><li><a href="ContentManager.html#updateTitle">updateTitle</a></li><li><a href="ContentManager.html#updateToolbar">updateToolbar</a></li></ul></div></li><li><a href="Core.html">Core</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Core_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Core.html#._globalListeners">_globalListeners</a></li><li><a href="Core.html#._initialized">_initialized</a></li><li><a href="Core.html#.globalListeners">globalListeners</a></li><li><a href="Core.html#.initialized">initialized</a></li><li><a href="Core.html#browser">browser</a></li><li><a href="Core.html#contentManager">contentManager</a></li><li><a href="Core.html#customEditors">customEditors</a></li><li><a href="Core.html#editionProperties">editionProperties</a></li><li><a href="Core.html#editMode">editMode</a></li><li><a href="Core.html#environment">environment</a></li><li><a href="Core.html#integrationModel">integrationModel</a></li><li><a href="Core.html#language">language</a></li><li><a href="Core.html#listeners">listeners</a></li><li><a href="Core.html#modalDialog">modalDialog</a></li><li><a href="Core.html#serviceProviderProperties">serviceProviderProperties</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Core.html#.addGlobalListener">addGlobalListener</a></li><li><a href="Core.html#addListener">addListener</a></li><li><a href="Core.html#getCustomEditors">getCustomEditors</a></li><li><a href="Core.html#getModalDialog">getModalDialog</a></li><li><a href="Core.html#init">init</a></li><li><a href="Core.html#insertElementOnSelection">insertElementOnSelection</a></li><li><a href="Core.html#insertFormula">insertFormula</a></li><li><a href="Core.html#openModalDialog">openModalDialog</a></li><li><a href="Core.html#placeCaretAfterNode">placeCaretAfterNode</a></li><li><a href="Core.html#setEnvironment">setEnvironment</a></li><li><a href="Core.html#setIntegrationModel">setIntegrationModel</a></li></ul></div></li><li><a href="CustomEditors.html">CustomEditors</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomEditors_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomEditors.html#activeEditor">activeEditor</a></li><li><a href="CustomEditors.html#editors">editors</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CustomEditors.html#addEditor">addEditor</a></li><li><a href="CustomEditors.html#disable">disable</a></li><li><a href="CustomEditors.html#enable">enable</a></li><li><a href="CustomEditors.html#getActiveEditor">getActiveEditor</a></li></ul></div></li><li><a href="EditorListener.html">EditorListener</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="EditorListener_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="EditorListener.html#isContentChanged">isContentChanged</a></li><li><a href="EditorListener.html#waitingForChanges">waitingForChanges</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="EditorListener.html#contentChanged">contentChanged</a></li><li><a href="EditorListener.html#getIsContentChanged">getIsContentChanged</a></li><li><a href="EditorListener.html#setIsContentChanged">setIsContentChanged</a></li><li><a href="EditorListener.html#setWaitingForChanges">setWaitingForChanges</a></li><li><a href="EditorListener.html#styleChanged">styleChanged</a></li><li><a href="EditorListener.html#transformationReceived">transformationReceived</a></li></ul></div></li><li><a href="Event.html">Event</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Event_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Event.html#cancelled">cancelled</a></li><li><a href="Event.html#defaultPrevented">defaultPrevented</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Event.html#cancel">cancel</a></li><li><a href="Event.html#preventDefault">preventDefault</a></li></ul></div></li><li><a href="Image.html">Image</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Image_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Image.html#.clone">clone</a></li><li><a href="Image.html#.fixAfterResize">fixAfterResize</a></li><li><a href="Image.html#.getMetricsFromBytes">getMetricsFromBytes</a></li><li><a href="Image.html#.getMetricsFromSvgString">getMetricsFromSvgString</a></li><li><a href="Image.html#.removeImgDataAttributes">removeImgDataAttributes</a></li><li><a href="Image.html#.setImgSize">setImgSize</a></li></ul></div></li><li><a href="IntegrationModel.html">IntegrationModel</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="IntegrationModel_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="IntegrationModel.html#.integrationParameters">integrationParameters</a></li><li><a href="IntegrationModel.html#callbackMethodArguments">callbackMethodArguments</a></li><li><a href="IntegrationModel.html#configurationService">configurationService</a></li><li><a href="IntegrationModel.html#core">core</a></li><li><a href="IntegrationModel.html#editorObject">editorObject</a></li><li><a href="IntegrationModel.html#environment">environment</a></li><li><a href="IntegrationModel.html#isIframe">isIframe</a></li><li><a href="IntegrationModel.html#language">language</a></li><li><a href="IntegrationModel.html#listeners">listeners</a></li><li><a href="IntegrationModel.html#managesLanguage">managesLanguage</a></li><li><a href="IntegrationModel.html#rtl">rtl</a></li><li><a href="IntegrationModel.html#serviceProviderProperties">serviceProviderProperties</a></li><li><a href="IntegrationModel.html#target">target</a></li><li><a href="IntegrationModel.html#temporalImageResizing">temporalImageResizing</a></li><li><a href="IntegrationModel.html#version">version</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="IntegrationModel.html#addEvents">addEvents</a></li><li><a href="IntegrationModel.html#callbackFunction">callbackFunction</a></li><li><a href="IntegrationModel.html#doubleClickHandler">doubleClickHandler</a></li><li><a href="IntegrationModel.html#fillNonLatexNode">fillNonLatexNode</a></li><li><a href="IntegrationModel.html#getBrowserLanguage">getBrowserLanguage</a></li><li><a href="IntegrationModel.html#getCore">getCore</a></li><li><a href="IntegrationModel.html#getLanguage">getLanguage</a></li><li><a href="IntegrationModel.html#getMathmlFromTextNode">getMathmlFromTextNode</a></li><li><a href="IntegrationModel.html#getPath">getPath</a></li><li><a href="IntegrationModel.html#getSelectedItem">getSelectedItem</a></li><li><a href="IntegrationModel.html#getSelection">getSelection</a></li><li><a href="IntegrationModel.html#getVersion">getVersion</a></li><li><a href="IntegrationModel.html#init">init</a></li><li><a href="IntegrationModel.html#insertFormula">insertFormula</a></li><li><a href="IntegrationModel.html#mousedownHandler">mousedownHandler</a></li><li><a href="IntegrationModel.html#mouseupHandler">mouseupHandler</a></li><li><a href="IntegrationModel.html#notifyWindowClosed">notifyWindowClosed</a></li><li><a href="IntegrationModel.html#openExistingFormulaEditor">openExistingFormulaEditor</a></li><li><a href="IntegrationModel.html#openNewFormulaEditor">openNewFormulaEditor</a></li><li><a href="IntegrationModel.html#setCore">setCore</a></li><li><a href="IntegrationModel.html#setEditorObject">setEditorObject</a></li><li><a href="IntegrationModel.html#setLanguage">setLanguage</a></li><li><a href="IntegrationModel.html#setTarget">setTarget</a></li><li><a href="IntegrationModel.html#updateFormula">updateFormula</a></li></ul></div></li><li><a href="Latex.html">Latex</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Latex_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Latex.html#._cache">_cache</a></li><li><a href="Latex.html#.cache">cache</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Latex.html#.getLatexFromMathML">getLatexFromMathML</a></li><li><a href="Latex.html#.getLatexFromTextNode">getLatexFromTextNode</a></li><li><a href="Latex.html#.getMathMLFromLatex">getMathMLFromLatex</a></li><li><a href="Latex.html#.parseMathmlToLatex">parseMathmlToLatex</a></li></ul></div></li><li><a href="Listeners.html">Listeners</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Listeners_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Listeners.html#listeners">listeners</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Listeners.html#.newListener">newListener</a></li><li><a href="Listeners.html#add">add</a></li><li><a href="Listeners.html#fire">fire</a></li></ul></div></li><li><a href="MathML.html">MathML</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="MathML_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="MathML.html#.addAnnotation">addAnnotation</a></li><li><a href="MathML.html#.addCustomEditorClassAttribute">addCustomEditorClassAttribute</a></li><li><a href="MathML.html#.containClass">containClass</a></li><li><a href="MathML.html#.encodeProperties">encodeProperties</a></li><li><a href="MathML.html#.isEmpty">isEmpty</a></li><li><a href="MathML.html#.isMathmlInAttribute">isMathmlInAttribute</a></li><li><a href="MathML.html#.mathMLEntities">mathMLEntities</a></li><li><a href="MathML.html#.removeAnnotation">removeAnnotation</a></li><li><a href="MathML.html#.removeCustomEditorClassAttribute">removeCustomEditorClassAttribute</a></li><li><a href="MathML.html#.removeSemantics">removeSemantics</a></li><li><a href="MathML.html#.removeSemanticsOcurrences">removeSemanticsOcurrences</a></li><li><a href="MathML.html#.safeXmlDecode">safeXmlDecode</a></li><li><a href="MathML.html#.safeXmlEncode">safeXmlEncode</a></li></ul></div></li><li><a href="ModalDialog.html">ModalDialog</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ModalDialog_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ModalDialog.html#deviceProperties">deviceProperties</a></li><li><a href="ModalDialog.html#rtl">rtl</a></li><li><a href="ModalDialog.html#websiteBeforeLockParameters">websiteBeforeLockParameters</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ModalDialog.html#activateResizeStateBR">activateResizeStateBR</a></li><li><a href="ModalDialog.html#activateResizeStateTL">activateResizeStateTL</a></li><li><a href="ModalDialog.html#addClass">addClass</a></li><li><a href="ModalDialog.html#addListeners">addListeners</a></li><li><a href="ModalDialog.html#cancelAction">cancelAction</a></li><li><a href="ModalDialog.html#close">close</a></li><li><a href="ModalDialog.html#create">create</a></li><li><a href="ModalDialog.html#createModalWindowAndroid">createModalWindowAndroid</a></li><li><a href="ModalDialog.html#createModalWindowDesktop">createModalWindowDesktop</a></li><li><a href="ModalDialog.html#createModalWindowIos">createModalWindowIos</a></li><li><a href="ModalDialog.html#createResizeButtons">createResizeButtons</a></li><li><a href="ModalDialog.html#createSubmitButton">createSubmitButton</a></li><li><a href="ModalDialog.html#drag">drag</a></li><li><a href="ModalDialog.html#eventClient">eventClient</a></li><li><a href="ModalDialog.html#focus">focus</a></li><li><a href="ModalDialog.html#getContentManager">getContentManager</a></li><li><a href="ModalDialog.html#getElementId">getElementId</a></li><li><a href="ModalDialog.html#getLimitWindow">getLimitWindow</a></li><li><a href="ModalDialog.html#getScrollBarWidth">getScrollBarWidth</a></li><li><a href="ModalDialog.html#handleClosedIosSoftkeyboard">handleClosedIosSoftkeyboard</a></li><li><a href="ModalDialog.html#handleOpenedIosSoftkeyboard">handleOpenedIosSoftkeyboard</a></li><li><a href="ModalDialog.html#hideKeyboard">hideKeyboard</a></li><li><a href="ModalDialog.html#initializeResizeProperties">initializeResizeProperties</a></li><li><a href="ModalDialog.html#isIE11">isIE11</a></li><li><a href="ModalDialog.html#isRTL">isRTL</a></li><li><a href="ModalDialog.html#lockWebsiteScroll">lockWebsiteScroll</a></li><li><a href="ModalDialog.html#maximize">maximize</a></li><li><a href="ModalDialog.html#minimize">minimize</a></li><li><a href="ModalDialog.html#onKeyDown">onKeyDown</a></li><li><a href="ModalDialog.html#onWindowResize">onWindowResize</a></li><li><a href="ModalDialog.html#open">open</a></li><li><a href="ModalDialog.html#orientationChangeAndroidSoftkeyboard">orientationChangeAndroidSoftkeyboard</a></li><li><a href="ModalDialog.html#orientationChangeIosSoftkeyboard">orientationChangeIosSoftkeyboard</a></li><li><a href="ModalDialog.html#portraitMode">portraitMode</a></li><li><a href="ModalDialog.html#recalculatePosition">recalculatePosition</a></li><li><a href="ModalDialog.html#recalculateScale">recalculateScale</a></li><li><a href="ModalDialog.html#recalculateScrollBar">recalculateScrollBar</a></li><li><a href="ModalDialog.html#recalculateSize">recalculateSize</a></li><li><a href="ModalDialog.html#reExpand">reExpand</a></li><li><a href="ModalDialog.html#removeClass">removeClass</a></li><li><a href="ModalDialog.html#removeListeners">removeListeners</a></li><li><a href="ModalDialog.html#restoreModalProperties">restoreModalProperties</a></li><li><a href="ModalDialog.html#restoreState">restoreState</a></li><li><a href="ModalDialog.html#restoreWebsiteScale">restoreWebsiteScale</a></li><li><a href="ModalDialog.html#saveModalProperties">saveModalProperties</a></li><li><a href="ModalDialog.html#setContainerHeight">setContainerHeight</a></li><li><a href="ModalDialog.html#setContentManager">setContentManager</a></li><li><a href="ModalDialog.html#setPosition">setPosition</a></li><li><a href="ModalDialog.html#setResizeButtonsVisibility">setResizeButtonsVisibility</a></li><li><a href="ModalDialog.html#setSize">setSize</a></li><li><a href="ModalDialog.html#setTitle">setTitle</a></li><li><a href="ModalDialog.html#showPopUpMessage">showPopUpMessage</a></li><li><a href="ModalDialog.html#stack">stack</a></li><li><a href="ModalDialog.html#startDrag">startDrag</a></li><li><a href="ModalDialog.html#stopDrag">stopDrag</a></li><li><a href="ModalDialog.html#submitAction">submitAction</a></li><li><a href="ModalDialog.html#unlockWebsiteScroll">unlockWebsiteScroll</a></li></ul></div></li><li><a href="Parser.html">Parser</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Parser_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Parser.html#.codeImgTransform">codeImgTransform</a></li><li><a href="Parser.html#.createImageSrc">createImageSrc</a></li><li><a href="Parser.html#.createShowImageSrc">createShowImageSrc</a></li><li><a href="Parser.html#.endParse">endParse</a></li><li><a href="Parser.html#.endParseEditMode">endParseEditMode</a></li><li><a href="Parser.html#.endParseSaveMode">endParseSaveMode</a></li><li><a href="Parser.html#.initParse">initParse</a></li><li><a href="Parser.html#.initParseEditMode">initParseEditMode</a></li><li><a href="Parser.html#.initParseSaveMode">initParseSaveMode</a></li><li><a href="Parser.html#.mathmlToImgObject">mathmlToImgObject</a></li><li><a href="Parser.html#.parseMathmlToImg">parseMathmlToImg</a></li></ul></div></li><li><a href="PopUpMessage.html">PopUpMessage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="PopUpMessage_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="PopUpMessage.html#buttonArea">buttonArea</a></li><li><a href="PopUpMessage.html#cancelButton">cancelButton</a></li><li><a href="PopUpMessage.html#closeButton">closeButton</a></li><li><a href="PopUpMessage.html#message">message</a></li><li><a href="PopUpMessage.html#overlayElement">overlayElement</a></li><li><a href="PopUpMessage.html#overlayWrapper">overlayWrapper</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="PopUpMessage.html#cancelAction">cancelAction</a></li><li><a href="PopUpMessage.html#closeAction">closeAction</a></li><li><a href="PopUpMessage.html#createButton">createButton</a></li><li><a href="PopUpMessage.html#onKeyDown">onKeyDown</a></li><li><a href="PopUpMessage.html#show">show</a></li></ul></div></li><li><a href="ServiceProvider.html">ServiceProvider</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ServiceProvider_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ServiceProvider.html#._integrationPath">_integrationPath</a></li><li><a href="ServiceProvider.html#._listeners">_listeners</a></li><li><a href="ServiceProvider.html#._parameters">_parameters</a></li><li><a href="ServiceProvider.html#._servicePaths">_servicePaths</a></li><li><a href="ServiceProvider.html#.integrationPath">integrationPath</a></li><li><a href="ServiceProvider.html#.listeners">listeners</a></li><li><a href="ServiceProvider.html#.parameters">parameters</a></li><li><a href="ServiceProvider.html#.parameters">parameters</a></li><li><a href="ServiceProvider.html#.servicePaths">servicePaths</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ServiceProvider.html#.addListener">addListener</a></li><li><a href="ServiceProvider.html#.createServiceURI">createServiceURI</a></li><li><a href="ServiceProvider.html#.fireEvent">fireEvent</a></li><li><a href="ServiceProvider.html#.getServerLanguageFromService">getServerLanguageFromService</a></li><li><a href="ServiceProvider.html#.getServerURL">getServerURL</a></li><li><a href="ServiceProvider.html#.getService">getService</a></li><li><a href="ServiceProvider.html#.getServicePath">getServicePath</a></li><li><a href="ServiceProvider.html#.getUrl">getUrl</a></li><li><a href="ServiceProvider.html#.init">init</a></li><li><a href="ServiceProvider.html#.setServicePath">setServicePath</a></li></ul></div></li><li><a href="StringManager.html">StringManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="StringManager_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="StringManager.html#.language">language</a></li><li><a href="StringManager.html#.strings">strings</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="StringManager.html#.get">get</a></li></ul></div></li><li><a href="TelemetryService.html">TelemetryService</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TelemetryService_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TelemetryService.html#._senderId">_senderId</a></li><li><a href="TelemetryService.html#._sessionId">_sessionId</a></li><li><a href="TelemetryService.html#.deployment">deployment</a></li><li><a href="TelemetryService.html#.endpoint">endpoint</a></li><li><a href="TelemetryService.html#.sender">sender</a></li><li><a href="TelemetryService.html#.senderId">senderId</a></li><li><a href="TelemetryService.html#.session">session</a></li><li><a href="TelemetryService.html#.sessionId">sessionId</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TelemetryService.html#.composeBody">composeBody</a></li><li><a href="TelemetryService.html#.composeUUID">composeUUID</a></li><li><a href="TelemetryService.html#.send">send</a></li></ul></div></li><li><a href="TextCache.html">TextCache</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TextCache_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TextCache.html#cache">cache</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TextCache.html#get">get</a></li><li><a href="TextCache.html#populate">populate</a></li></ul></div></li><li><a href="Util.html">Util</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Util_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Util.html#.addArgument">addArgument</a></li><li><a href="Util.html#.addClass">addClass</a></li><li><a href="Util.html#.addElementEvents">addElementEvents</a></li><li><a href="Util.html#.addEvent">addEvent</a></li><li><a href="Util.html#.b64ToByteArray">b64ToByteArray</a></li><li><a href="Util.html#.compareStrings">compareStrings</a></li><li><a href="Util.html#.concatenateUrl">concatenateUrl</a></li><li><a href="Util.html#.containsClass">containsClass</a></li><li><a href="Util.html#.convertOldXmlinitialtextAttribute">convertOldXmlinitialtextAttribute</a></li><li><a href="Util.html#.createElement">createElement</a></li><li><a href="Util.html#.createHttpRequest">createHttpRequest</a></li><li><a href="Util.html#.createObject">createObject</a></li><li><a href="Util.html#.createObjectCode">createObjectCode</a></li><li><a href="Util.html#.decode64">decode64</a></li><li><a href="Util.html#.fireEvent">fireEvent</a></li><li><a href="Util.html#.fixedCharCodeAt">fixedCharCodeAt</a></li><li><a href="Util.html#.getElementsByNameFromString">getElementsByNameFromString</a></li><li><a href="Util.html#.getNodeLength">getNodeLength</a></li><li><a href="Util.html#.getSelectedItem">getSelectedItem</a></li><li><a href="Util.html#.getSelectedItemOnTextarea">getSelectedItemOnTextarea</a></li><li><a href="Util.html#.getWIRISImageOutput">getWIRISImageOutput</a></li><li><a href="Util.html#.htmlEntities">htmlEntities</a></li><li><a href="Util.html#.htmlEntitiesDecode">htmlEntitiesDecode</a></li><li><a href="Util.html#.httpBuildQuery">httpBuildQuery</a></li><li><a href="Util.html#.propertiesToString">propertiesToString</a></li><li><a href="Util.html#.readByte">readByte</a></li><li><a href="Util.html#.readBytes">readBytes</a></li><li><a href="Util.html#.readInt32">readInt32</a></li><li><a href="Util.html#.removeClass">removeClass</a></li><li><a href="Util.html#.removeEvent">removeEvent</a></li><li><a href="Util.html#.updateExistingTextOnTextarea">updateExistingTextOnTextarea</a></li><li><a href="Util.html#.updateTextArea">updateTextArea</a></li><li><a href="Util.html#.urlEncode">urlEncode</a></li><li><a href="Util.html#.urlToAssArray">urlToAssArray</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3><a href="global.html">Global</a></h3></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Parser from './parser';
import Util from './util';
import StringManager from './stringmanager';
import ContentManager from './contentmanager';
import Latex from './latex';
import MathML from './mathml';
import CustomEditors from './customeditors';
import Configuration from './configuration';
import jsProperties from './jsvariables';
import Event from './event';
import Listeners from './listeners';
import Image from './image';
import ServiceProvider from './serviceprovider';
import ModalDialog from './modal';
import './polyfills';
import '../styles/styles.css';

/**
 * @typedef {Object} CoreProperties
 * @property {ServiceProviderProperties} serviceProviderProperties
 * - The ServiceProvider class properties. *
 */
export default class Core {
  /**
   * @classdesc
   * This class represents MathType integration Core, managing the following:
   * - Integration initialization.
   * - Event managing.
   * - Insertion of formulas into the edit area.
   * ```js
   *       let core = new Core();
   *       core.addListener(listener);
   *       core.language = 'en';
   *
   *       // Initializing Core class.
   *       core.init(configurationService);
   * ```
   * @constructs
   * Core constructor.
   * @param {CoreProperties}
   */
  constructor(coreProperties) {
    /**
     * Language. Needed for accessibility and locales. 'en' by default.
     * @type {String}
     */
    this.language = 'en';

    /**
     * Edit mode, 'images' by default. Admits the following values:
     * - images
     * - latex
     * @type {String}
     */
    this.editMode = 'images';

    /**
     * Modal dialog instance.
     * @type {ModalDialog}
     */
    this.modalDialog = null;

    /**
     * The instance of {@link CustomEditors}. By default
     * the only custom editor is the Chemistry editor.
     * @type {CustomEditors}
     */
    this.customEditors = new CustomEditors();

    /**
     * Chemistry editor.
     * @type {CustomEditor}
     */
    const chemEditorParams = {
      name: 'Chemistry',
      toolbar: 'chemistry',
      icon: 'chem.png',
      confVariable: 'chemEnabled',
      title: 'ChemType',
      tooltip: 'Insert a chemistry formula - ChemType', // TODO: Localize tooltip.
    };

    this.customEditors.addEditor('chemistry', chemEditorParams);

    /**
     * Environment properties. This object contains data about the integration platform.
     * @typedef IntegrationEnvironment
     * @property {String} IntegrationEnvironment.editor - Editor name. For example the HTML editor.
     * @property {String} IntegrationEnvironment.mode - Integration save mode.
     * @property {String} IntegrationEnvironment.version - Integration version.
     *
     */

    /**
     * The environment properties object.
     * @type {IntegrationEnvironment}
     */
    this.environment = {};

    /**
     * @typedef EditionProperties
     * @property {Boolean} editionProperties.isNewElement - True if the formula is a new one.
     * False otherwise.
     * @property {HTMLImageElement} editionProperties.temporalImage- The image element.
     * Null if the formula is new.
     * @property {Range} editionProperties.latexRange - Tha range that contains the LaTeX formula.
     * @property {Range} editionProperties.range - The range that contains the image element.
     * @property {String} editionProperties.editMode - The edition mode. 'images' by default.
     */

    /**
     * The properties of the current edition process.
     * @type {EditionProperties}
     */
    this.editionProperties = {};

    this.editionProperties.isNewElement = true;
    this.editionProperties.temporalImage = null;
    this.editionProperties.latexRange = null;
    this.editionProperties.range = null;

    /**
     * The {@link IntegrationModel} instance.
     * @type {IntegrationModel}
     */
    this.integrationModel = null;

    /**
     * The {@link ContentManager} instance.
     * @type {ContentManager}
     */
    this.contentManager = null;

    /**
     * The current browser.
     * @type {String}
     */
    this.browser = (() => {
      const ua = navigator.userAgent;
      let browser = 'none';
      if (ua.search('Edge/') >= 0) {
        browser = 'EDGE';
      } else if (ua.search('Chrome/') >= 0) {
        browser = 'CHROME';
      } else if (ua.search('Trident/') >= 0) {
        browser = 'IE';
      } else if (ua.search('Firefox/') >= 0) {
        browser = 'FIREFOX';
      } else if (ua.search('Safari/') >= 0) {
        browser = 'SAFARI';
      }
      return browser;
    }
    )();

    /**
     * Plugin listeners.
     * @type {Array.&lt;Object>}
     */
    this.listeners = new Listeners();

    /**
     * Service provider properties.
     * @type {ServiceProviderProperties}
     */
    this.serviceProviderProperties = {};
    if ('serviceProviderProperties' in coreProperties) {
      this.serviceProviderProperties = coreProperties.serviceProviderProperties;
    } else {
      throw new Error('serviceProviderProperties property missing.');
    }
  }

  /**
   * Static property.
   * Core listeners.
   * @private
   * @type {Listeners}
   */
  static get globalListeners() {
    return Core._globalListeners;
  }

  /**
   * Static property setter.
   * Set core listeners.
   * @param {Listeners} value - The property value.
   * @ignore
   */
  static set globalListeners(value) {
    Core._globalListeners = value;
  }

  /**
   * Core state. Says if it was loaded previously.
   * True when Core.init was called. Otherwise, false.
   * @private
   * @type {Boolean}
   */
  static get initialized() {
    return Core._initialized;
  }

  /**
   * Core state. Says if it was loaded previously.
   * @param {Boolean} value - True to say that Core.init was called. Otherwise, false.
   * @ignore
   */
  static set initialized(value) {
    Core._initialized = value;
  }

  /**
   * Sets the {@link Core.integrationModel} property.
   * @param {IntegrationModel} integrationModel - The {@link IntegrationModel} property.
   */
  setIntegrationModel(integrationModel) {
    this.integrationModel = integrationModel;
  }

  /**
   * Sets the {@link Core.environment} property.
   * @param {IntegrationEnvironment} integrationEnvironment -
   * The {@link IntegrationEnvironment} object.
   */
  setEnvironment(integrationEnvironment) {
    if ('editor' in integrationEnvironment) {
      this.environment.editor = integrationEnvironment.editor;
    }
    if ('mode' in integrationEnvironment) {
      this.environment.mode = integrationEnvironment.mode;
    }
    if ('version' in integrationEnvironment) {
      this.environment.version = integrationEnvironment.version;
    }
  }

  /**
   * Returns the current {@link ModalDialog} instance.
   * @returns {ModalDialog} The current {@link ModalDialog} instance.
   */
  getModalDialog() {
    return this.modalDialog;
  }

  /**
   * Inits the {@link Core} class, doing the following:
   * - Calls asynchronously configuration service, retrieving the backend configuration in a JSON.
   * - Updates {@link Configuration} class with the previous configuration properties.
   * - Updates the {@link ServiceProvider} class using the configuration service path as reference.
   * - Loads language strings.
   * - Fires onLoad event.
   * @param {Object} serviceParameters - Service parameters.
   */
  init() {
    if (!Core.initialized) {
      const serviceProviderListener = Listeners.newListener('onInit', () => {
        const jsConfiguration = ServiceProvider.getService('configurationjs', '', 'get');
        const jsonConfiguration = JSON.parse(jsConfiguration);
        Configuration.addConfiguration(jsonConfiguration);
        // Adding JavaScript (not backend) configuration variables.
        Configuration.addConfiguration(jsProperties);
        // Fire 'onLoad' event:
        // All integration must listen this event in order to know if the plugin
        // has been properly loaded.
        StringManager.language = this.language;
        this.listeners.fire('onLoad', {});
      });

      ServiceProvider.addListener(serviceProviderListener);
      ServiceProvider.init(this.serviceProviderProperties);

      Core.initialized = true;
    } else {
      // Case when there are more than two editor instances.
      // After the first editor all the other editors don't need to load any file or service.
      this.listeners.fire('onLoad', {});
    }
  }

  /**
   * Adds a {@link Listener} to the current instance of the {@link Core} class.
   * @param {Listener} listener - The listener object.
   */
  addListener(listener) {
    this.listeners.add(listener);
  }

  /**
   * Adds the global {@link Listener} instance to {@link Core} class.
   * @param {Listener} listener - The event listener to be added.
   * @static
   */
  static addGlobalListener(listener) {
    Core.globalListeners.add(listener);
  }

  beforeUpdateFormula(mathml, wirisProperties) {
    /**
     * This event is fired before updating the formula.
     * @type {Object}
     * @property {String} mathml - MathML to be transformed.
     * @property {String} editMode - Edit mode.
     * @property {Object} wirisProperties - Extra attributes for the formula.
     * @property {String} language - Formula language.
     */
    const beforeUpdateEvent = new Event();

    beforeUpdateEvent.mathml = mathml;

    // Cloning wirisProperties object
    // We don't want wirisProperties object modified.
    beforeUpdateEvent.wirisProperties = {};

    if (wirisProperties != null) {
      Object.keys(wirisProperties).forEach((attr) => {
        beforeUpdateEvent.wirisProperties[attr] = wirisProperties[attr];
      });
    }


    // Read only.
    beforeUpdateEvent.language = this.language;
    beforeUpdateEvent.editMode = this.editMode;

    if (this.listeners.fire('onBeforeFormulaInsertion', beforeUpdateEvent)) {
      return {};
    }

    if (Core.globalListeners.fire('onBeforeFormulaInsertion', beforeUpdateEvent)) {
      return {};
    }

    return {
      mathml: beforeUpdateEvent.mathml,
      wirisProperties: beforeUpdateEvent.wirisProperties,
    };
  }

  /**
   * Converts a MathML into it's correspondent image and inserts the image is
   * inserted in a HTMLElement target by creating
   * a new image or updating an existing one.
   * @param {HTMLElement} focusElement - The HTMLElement to be focused after the insertion.
   * @param {Window} windowTarget - The window element where the editable content is.
   * @param {String} mathml - The MathML.
   * @param {Array.&lt;Object>} wirisProperties - The extra attributes for the formula.
   * @returns {ReturnObject} - Object with the information of the node or latex to insert.
   */
  insertFormula(focusElement, windowTarget, mathml, wirisProperties) {
    /**
     * It is the object with the information of the node or latex to insert.
     * @typedef ReturnObject
     * @property {Node} [node] - The DOM node to insert.
     * @property {String} [latex] - The latex to insert.
     */
    const returnObject = {};

    if (!mathml) {
      this.insertElementOnSelection(null, focusElement, windowTarget);
    } else if (this.editMode === 'latex') {
      returnObject.latex = Latex.getLatexFromMathML(mathml);
      // this.integrationModel.getNonLatexNode is an integration wrapper
      // to have special behaviours for nonLatex.
      // Not all the integrations have special behaviours for nonLatex.
      if (!!this.integrationModel.fillNonLatexNode &amp;&amp; !returnObject.latex) {
        const afterUpdateEvent = new Event();
        afterUpdateEvent.editMode = this.editMode;
        afterUpdateEvent.windowTarget = windowTarget;
        afterUpdateEvent.focusElement = focusElement;
        afterUpdateEvent.latex = returnObject.latex;
        this.integrationModel.fillNonLatexNode(afterUpdateEvent, windowTarget, mathml);
      } else {
        returnObject.node = windowTarget.document.createTextNode(`$$${returnObject.latex}$$`);
      }
      this.insertElementOnSelection(returnObject.node, focusElement, windowTarget);
    } else {
      returnObject.node = Parser.mathmlToImgObject(windowTarget.document,
        mathml,
        wirisProperties, this.language);

      this.insertElementOnSelection(returnObject.node, focusElement, windowTarget);
    }

    return returnObject;
  }

  afterUpdateFormula(focusElement, windowTarget, node, latex) {
    /**
     * This event is fired after update the formula.
     * @type {Event}
     * @param {String} editMode - edit mode.
     * @param {Object} windowTarget - target window.
     * @param {Object} focusElement - target element to be focused after update.
     * @param {String} latex - LaTeX generated by the formula (editMode=latex).
     * @param {Object} node - node generated after update the formula (text if LaTeX img otherwise).
     */
    const afterUpdateEvent = new Event();
    afterUpdateEvent.editMode = this.editMode;
    afterUpdateEvent.windowTarget = windowTarget;
    afterUpdateEvent.focusElement = focusElement;
    afterUpdateEvent.node = node;
    afterUpdateEvent.latex = latex;

    if (this.listeners.fire('onAfterFormulaInsertion', afterUpdateEvent)) {
      return {};
    }

    if (Core.globalListeners.fire('onAfterFormulaInsertion', afterUpdateEvent)) {
      return {};
    }

    return {};
  }

  /**
   * Sets the caret after a given Node and set the focus to the owner document.
   * @param {Node} node - The Node element.
   */
  placeCaretAfterNode(node) {
    this.integrationModel.getSelection();
    const nodeDocument = node.ownerDocument;
    if (typeof nodeDocument.getSelection !== 'undefined' &amp;&amp; !!node.parentElement) {
      const range = nodeDocument.createRange();
      range.setStartAfter(node);
      range.collapse(true);
      const selection = nodeDocument.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      nodeDocument.body.focus();
    }
  }

  /**
   * Replaces a Selection object with an HTMLElement.
   * @param {HTMLElement} element - The HTMLElement to replace the selection.
   * @param {HTMLElement} focusElement - The HTMLElement to be focused after the replace.
   * @param {Window} windowTarget - The window target.
   */
  insertElementOnSelection(element, focusElement, windowTarget) {
    if (this.editionProperties.isNewElement) {
      if (element) {
        if (focusElement.type === 'textarea') {
          Util.updateTextArea(focusElement, element.textContent);
        } else if (document.selection &amp;&amp; document.getSelection === 0) {
          let range = windowTarget.document.selection.createRange();
          windowTarget.document.execCommand('InsertImage', false, element.src);

          if (!('parentElement' in range)) {
            windowTarget.document.execCommand('delete', false);
            range = windowTarget.document.selection.createRange();
            windowTarget.document.execCommand('InsertImage', false, element.src);
          }

          if ('parentElement' in range) {
            const temporalObject = range.parentElement();

            if (temporalObject.nodeName.toUpperCase() === 'IMG') {
              temporalObject.parentNode.replaceChild(element, temporalObject);
            } else {
              // IE9 fix: parentNode() does not return the IMG node,
              // returns the parent DIV node. In IE &lt; 9, pasteHTML does not work well.
              range.pasteHTML(Util.createObjectCode(element));
            }
          }
        } else {
          const editorSelection = this.integrationModel.getSelection();
          let range = null;
          // In IE is needed keep the range due to after focus the modal window
          // it can't be retrieved the last selection.
          if (this.editionProperties.range) {
            ({ range } = this.editionProperties);
            this.editionProperties.range = null;
          } else {
            range = editorSelection.getRangeAt(0);
          }

          // Delete if something was surrounded.
          range.deleteContents();

          let node = range.startContainer;
          const position = range.startOffset;

          if (node.nodeType === 3) { // TEXT_NODE.
            node = node.splitText(position);
            node.parentNode.insertBefore(element, node);
          } else if (node.nodeType === 1) { // ELEMENT_NODE.
            node.insertBefore(element, node.childNodes[position]);
          }

          this.placeCaretAfterNode(element);
        }
      } else if (focusElement.type === 'textarea') {
        focusElement.focus();
      } else {
        const editorSelection = this.integrationModel.getSelection();
        editorSelection.removeAllRanges();

        if (this.editionProperties.range) {
          const { range } = this.editionProperties;
          this.editionProperties.range = null;
          editorSelection.addRange(range);
        }
      }
    } else if (this.editionProperties.latexRange) {
      if (document.selection &amp;&amp; document.getSelection === 0) {
        this.editionProperties.isNewElement = true;
        this.editionProperties.latexRange.select();
        this.insertElementOnSelection(element, focusElement, windowTarget);
      } else {
        this.editionProperties.latexRange.deleteContents();
        this.editionProperties.latexRange.insertNode(element);
        this.placeCaretAfterNode(element);
      }
    } else if (focusElement.type === 'textarea') {
      let item;
      // Wrapper for some integrations that can have special behaviours to show latex.
      if (typeof this.integrationModel.getSelectedItem !== 'undefined') {
        item = this.integrationModel.getSelectedItem(focusElement, false);
      } else {
        item = Util.getSelectedItemOnTextarea(focusElement);
      }
      Util.updateExistingTextOnTextarea(focusElement,
        element.textContent,
        item.startPosition,
        item.endPosition);
    } else {
      if (element &amp;&amp; element.nodeName.toLowerCase() === 'img') { // Editor empty, formula has been erased on edit.
        // There are editors (e.g: CKEditor) that put attributes in images.
        // We don't allow that behaviour in our images.
        Image.removeImgDataAttributes(this.editionProperties.temporalImage);
        // Clone is needed to maintain event references to temporalImage.
        Image.clone(element, this.editionProperties.temporalImage);
      } else {
        this.editionProperties.temporalImage.remove();
      }
      this.placeCaretAfterNode(this.editionProperties.temporalImage);
    }
  }


  /**
   * Opens a modal dialog containing MathType editor..
   * @param {HTMLElement} target - The target HTMLElement where formulas should be inserted.
   * @param {Boolean} isIframe - True if the target HTMLElement is an iframe. False otherwise.
   */
  openModalDialog(target, isIframe) {
    // Textarea elements don't have normal document ranges. It only accepts latex edit.
    this.editMode = 'images';

    // In IE is needed keep the range due to after focus the modal window
    // it can't be retrieved the last selection.
    try {
      if (isIframe) {
        // Is needed focus the target first.
        target.contentWindow.focus();
        const selection = target.contentWindow.getSelection();
        this.editionProperties.range = selection.getRangeAt(0);
      } else {
        // Is needed focus the target first.
        target.focus();
        const selection = getSelection();
        this.editionProperties.range = selection.getRangeAt(0);
      }
    } catch (e) {
      this.editionProperties.range = null;
    }

    if (isIframe === undefined) {
      isIframe = true;
    }

    this.editionProperties.latexRange = null;

    if (target) {
      let selectedItem;
      if (typeof this.integrationModel.getSelectedItem !== 'undefined') {
        selectedItem = this.integrationModel.getSelectedItem(target, isIframe);
      } else {
        selectedItem = Util.getSelectedItem(target, isIframe);
      }

      // Check LaTeX if and only if the node is a text node (nodeType==3).
      if (selectedItem) {
        // Case when image was selected and button pressed.
        if (!selectedItem.caretPosition &amp;&amp; Util.containsClass(selectedItem.node, Configuration.get('imageClassName'))) {
          this.editionProperties.temporalImage = selectedItem.node;
          this.editionProperties.isNewElement = false;
        } else if (selectedItem.node.nodeType === 3) {
          // If it's a text node means that editor is working with LaTeX.
          if (this.integrationModel.getMathmlFromTextNode) {
            // If integration has this function it isn't set range due to we don't
            // know if it will be put into a textarea as a text or image.
            const mathml = this.integrationModel.getMathmlFromTextNode(
              selectedItem.node,
              selectedItem.caretPosition,
            );
            if (mathml) {
              this.editMode = 'latex';
              this.editionProperties.isNewElement = false;
              this.editionProperties.temporalImage = document.createElement('img');
              this.editionProperties.temporalImage.setAttribute(
                Configuration.get('imageMathmlAttribute'),
                MathML.safeXmlEncode(mathml),
              );
            }
          } else {
            const latexResult = Latex.getLatexFromTextNode(
              selectedItem.node,
              selectedItem.caretPosition,
            );
            if (latexResult) {
              const mathml = Latex.getMathMLFromLatex(latexResult.latex);
              this.editMode = 'latex';
              this.editionProperties.isNewElement = false;
              this.editionProperties.temporalImage = document.createElement('img');
              this.editionProperties.temporalImage.setAttribute(
                Configuration.get('imageMathmlAttribute'),
                MathML.safeXmlEncode(mathml),
              );
              const windowTarget = isIframe ? target.contentWindow : window;

              if (target.tagName.toLowerCase() !== 'textarea') {
                if (document.selection) {
                  let leftOffset = 0;
                  let previousNode = latexResult.startNode.previousSibling;

                  while (previousNode) {
                    leftOffset += Util.getNodeLength(previousNode);
                    previousNode = previousNode.previousSibling;
                  }

                  this.editionProperties.latexRange = windowTarget.document.selection.createRange();
                  this.editionProperties.latexRange.moveToElementText(
                    latexResult.startNode.parentNode,
                  );
                  this.editionProperties.latexRange.move(
                    'character',
                    leftOffset + latexResult.startPosition,
                  );
                  this.editionProperties.latexRange.moveEnd(
                    'character',
                    latexResult.latex.length + 4,
                  ); // Plus 4 for the '$$' characters.
                } else {
                  this.editionProperties.latexRange = windowTarget.document.createRange();
                  this.editionProperties.latexRange.setStart(
                    latexResult.startNode,
                    latexResult.startPosition,
                  );
                  this.editionProperties.latexRange.setEnd(
                    latexResult.endNode,
                    latexResult.endPosition,
                  );
                }
              }
            }
          }
        }
      } else if (target.tagName.toLowerCase() === 'textarea') {
        // By default editMode is 'images', but when target is a textarea it needs to be 'latex'.
        this.editMode = 'latex';
      }
    }

    // Setting an object with the editor parameters.
    // Editor parameters can be customized in several ways:
    // 1 - editorAttributes: Contains the default editor attributes,
    //  usually the metrics in a comma separated string. Always exists.
    // 2 - editorParameters: Object containing custom editor parameters.
    // These parameters are defined in the backend. So they affects all integration instances.

    // The backend send the default editor attributes in a coma separated
    // with the following structure: key1=value1,key2=value2...
    const defaultEditorAttributesArray = Configuration.get('editorAttributes').split(', ');
    const defaultEditorAttributes = {};
    for (let i = 0, len = defaultEditorAttributesArray.length; i &lt; len; i += 1) {
      const tempAttribute = defaultEditorAttributesArray[i].split('=');
      const key = tempAttribute[0];
      const value = tempAttribute[1];
      defaultEditorAttributes[key] = value;
    }
    // Custom editor parameters.
    const editorAttributes = {};
    // Editor parameters in backend, usually configuration.ini.
    const serverEditorParameters = Configuration.get('editorParameters');
    // Editor parameters through JavaScript configuration.
    const cliendEditorParameters = this.integrationModel.editorParameters;
    Object.assign(editorAttributes, defaultEditorAttributes, serverEditorParameters);
    Object.assign(editorAttributes, defaultEditorAttributes, cliendEditorParameters);

    editorAttributes.language = this.language;
    editorAttributes.rtl = this.integrationModel.rtl;

    const contentManagerAttributes = {};
    contentManagerAttributes.editorAttributes = editorAttributes;
    contentManagerAttributes.language = this.language;
    contentManagerAttributes.customEditors = this.customEditors;
    contentManagerAttributes.environment = this.environment;

    if (this.modalDialog == null) {
      this.modalDialog = new ModalDialog(editorAttributes);
      this.contentManager = new ContentManager(contentManagerAttributes);
      // When an instance of ContentManager is created we need to wait until
      // the ContentManager is ready by listening 'onLoad' event.
      const listener = Listeners.newListener('onLoad', () => {
        this.contentManager.isNewElement = this.editionProperties.isNewElement;
        if (this.editionProperties.temporalImage != null) {
          const mathML = MathML.safeXmlDecode(this.editionProperties.temporalImage.getAttribute(Configuration.get('imageMathmlAttribute')));
          this.contentManager.mathML = mathML;
        }
      });
      this.contentManager.addListener(listener);
      this.contentManager.init();
      this.modalDialog.setContentManager(this.contentManager);
      this.contentManager.setModalDialogInstance(this.modalDialog);
    } else {
      this.contentManager.isNewElement = this.editionProperties.isNewElement;
      if (this.editionProperties.temporalImage != null) {
        const mathML = MathML.safeXmlDecode(this.editionProperties.temporalImage.getAttribute(Configuration.get('imageMathmlAttribute')));
        this.contentManager.mathML = mathML;
      }
    }
    this.contentManager.setIntegrationModel(this.integrationModel);
    this.modalDialog.open();
  }

  /**
   * Returns the {@link CustomEditors} instance.
   * @return {CustomEditors} The current {@link CustomEditors} instance.
   */
  getCustomEditors() {
    return this.customEditors;
  }
}

/**
 * Core static listeners.
 * @type {Listeners}
 * @private
 */
Core._globalListeners = new Listeners();

/**
 * Resources state. Says if they were loaded or not.
 * @type {Boolean}
 * @private
 */
Core._initialized = false;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="">
    <div class="footer-text">NHN Entertainment. Frontend Development Lab</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
